<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FIRM UI</title>
    <style>
      body { margin: 0; font-family: system-ui, sans-serif; background: #0b0b0b; color: #eaeaea; min-height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
      .tabs { position: sticky; top: 0; z-index: 50; display: flex; gap: 8px; padding: 8px; border-bottom: 1px solid #333; align-items: center; background: rgba(11,11,11,0.9); backdrop-filter: blur(8px); }
      .tab { padding: 8px 12px; cursor: pointer; border-radius: 6px; background: #151515; transition: background 0.2s; border: none; color: #eaeaea; font-size: 14px; }
      .tab:hover { background: #1a1a1a; }
      .active { background: #1f1f1f; }
      .interpretation-btn { background: #2a4a6a; margin-left: auto; }
      .interpretation-btn:hover { background: #3a5a7a; }
      
      /* Metrics Panel */
      .metrics-panel { position: sticky; top: 48px; z-index: 40; background: rgba(15,15,15,0.92); border-bottom: 1px solid #333; backdrop-filter: blur(8px); }
      .metrics-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; cursor: pointer; }
      .metrics-title { font-size: 13px; font-weight: 600; color: #4a9eff; }
      .metrics-toggle { background: none; border: none; color: #888; font-size: 16px; cursor: pointer; padding: 0; }
      .metrics-content { padding: 0 12px 12px 12px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
      .metrics-content.expanded { max-height: 240px; overflow-y: auto; }
      .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
      .metric-group { background: #1a1a1a; padding: 10px; border-radius: 6px; border: 1px solid #2a2a2a; }
      .metric-group h4 { margin: 0 0 8px 0; font-size: 12px; color: #4a9eff; font-weight: 600; }
      .metric-row { display: flex; justify-content: space-between; font-size: 11px; margin: 4px 0; }
      .metric-label { color: #aaa; }
      .metric-row span:last-child { color: #eee; font-weight: 600; font-family: 'Courier New', monospace; }
      
      #canvasContainer { position: relative; flex: 1 1 auto; width: 100%; }
      #canvas { width: 100%; height: 100%; display: block; }
      
      .a11y { position: fixed; top: 110px; right: 12px; font-size: 12px; background: rgba(0,0,0,0.85); padding: 8px; border-radius: 4px; max-height: calc(100vh - 130px); overflow-y: auto; width: 280px; z-index: 1000; backdrop-filter: blur(10px); }
      .metrics-panel.expanded + #canvasContainer { flex: 1 1 calc(100% - 220px); }
      .metrics-panel.collapsed + #canvasContainer { flex: 1 1 auto; }
      .a11y label { display: block; margin: 4px 0; }
      
      /* Accessibility overrides */
      body.high-contrast { background: #000; color: #fff; }
      body.high-contrast .tab { background: #222; border: 1px solid #666; }
      body.high-contrast .active { background: #444; }
      body.no-motion * { transition: none !important; animation: none !important; }
    </style>
  </head>
  <body>
    <div class="tabs">
      <div class="tab active" data-view="clifford">Clifford Field (Spacetime)</div>
      <div class="tab" data-view="zx">ZX Graph (Quantum)</div>
      <div class="tab" data-view="consciousness">Consciousness</div>
      <div class="tab" data-view="sheaf">Sheaf Tree</div>
      <div class="tab" data-view="echo">Echo Map</div>
      <button id="openInterpretation" class="tab interpretation-btn">🔬 Physics Guide</button>
    </div>
    
    <!-- Scientific Metrics Panel -->
    <div id="metricsPanel" class="metrics-panel">
      <div class="metrics-header">
        <span class="metrics-title">📊 Scientific Metrics</span>
        <button id="toggleMetrics" class="metrics-toggle">▶</button>
      </div>
      <div id="metricsContent" class="metrics-content">
        <div class="metrics-grid">
          <div class="metric-group">
            <h4>ZX Graph Structure</h4>
            <div class="metric-row"><span class="metric-label">Nodes:</span><span id="metric-nodes">-</span></div>
            <div class="metric-row"><span class="metric-label">Z-spiders:</span><span id="metric-z-spiders">-</span></div>
            <div class="metric-row"><span class="metric-label">X-spiders:</span><span id="metric-x-spiders">-</span></div>
            <div class="metric-row"><span class="metric-label">Edges:</span><span id="metric-edges">-</span></div>
            <div class="metric-row"><span class="metric-label">Coherence C(G):</span><span id="metric-coherence">-</span></div>
          </div>
          
          <div class="metric-group">
            <h4>Clifford Field (Cl(1,3))</h4>
            <div class="metric-row"><span class="metric-label">Scalar (grade-0):</span><span id="metric-scalar">-</span></div>
            <div class="metric-row"><span class="metric-label">Vectors (grade-1):</span><span id="metric-vectors">-</span></div>
            <div class="metric-row"><span class="metric-label">Bivectors (grade-2):</span><span id="metric-bivectors">-</span></div>
            <div class="metric-row"><span class="metric-label">Trivectors (grade-3):</span><span id="metric-trivectors">-</span></div>
            <div class="metric-row"><span class="metric-label">Pseudoscalar:</span><span id="metric-pseudo">-</span></div>
          </div>
          
          <div class="metric-group">
            <h4>Evolution Dynamics</h4>
            <div class="metric-row"><span class="metric-label">Total rewrites:</span><span id="metric-rewrites">-</span></div>
            <div class="metric-row"><span class="metric-label">Fusion events:</span><span id="metric-fusion">-</span></div>
            <div class="metric-row"><span class="metric-label">Color-flips:</span><span id="metric-colorflip">-</span></div>
            <div class="metric-row"><span class="metric-label">Grace emergence:</span><span id="metric-grace">-</span></div>
            <div class="metric-row"><span class="metric-label">Evolution steps:</span><span id="metric-steps">-</span></div>
          </div>
          
          <div class="metric-group">
            <h4>Physics Observables</h4>
            <div class="metric-row"><span class="metric-label">Predicted spheres:</span><span id="metric-pred-spheres">-</span></div>
            <div class="metric-row"><span class="metric-label">Dominant grade:</span><span id="metric-dom-grade">-</span></div>
            <div class="metric-row"><span class="metric-label">Audio coherence α:</span><span id="metric-audio">-</span></div>
            <div class="metric-row"><span class="metric-label">Bootstrap energy:</span><span id="metric-boot-energy">-</span></div>
            <div class="metric-row"><span class="metric-label">Emergence rate:</span><span id="metric-emerg-rate">-</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="canvasContainer">
      <canvas id="canvas"></canvas>
    </div>
    <div class="a11y">
      <label><input type="checkbox" id="noMotion" /> Reduce motion</label>
      <label><input type="checkbox" id="highContrast" /> High contrast</label>
      <button id="enableAudio" style="margin-top: 8px; padding: 4px 8px;">Enable Audio</button>
      
      <!-- THEORY-COMPLIANT EXPLORATION CONTROLS -->
      <div style="margin-top: 12px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px;">
        <div style="font-size: 11px; margin-bottom: 6px; color: #ccc;">🔬 Theory Exploration</div>
        
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Grace Coherence φ: <span id="graceValue">1.618</span>
          <input type="range" id="graceSlider" min="1.0" max="2.5" step="0.001" value="1.618" style="width: 80px;">
        </label>
        
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Bootstrap Energy: <span id="bootstrapValue">1.0</span>
          <input type="range" id="bootstrapSlider" min="0.1" max="5.0" step="0.01" value="1.0" style="width: 80px;">
        </label>
        
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Emergence Rate: <span id="emergenceValue">1.0</span>
          <input type="range" id="emergenceSlider" min="0.1" max="3.0" step="0.01" value="1.0" style="width: 80px;">
        </label>

        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Observation Distance: <span id="distanceValue">Auto</span>
          <input type="range" id="distanceSlider" min="1" max="50" step="0.1" value="25" style="width: 80px;">
        </label>

        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Camera Vantage Point:
          <select id="vantageSelector" style="font-size: 10px;">
            <option value="auto">Automatic (Emergent)</option>
            <option value="seed_axis">Seed Axis (Z-chain)</option>
            <option value="orthogonal">Orthogonal Cross-Section</option>
            <option value="bootstrap_loop">Bootstrap Loop</option>
            <option value="coherence_peak">Coherence Peak</option>
            <option value="custom">Custom (Preserve manual)</option>
          </select>
        </label>
        
        <button id="resetEvolution" style="margin-top: 4px; padding: 2px 6px; font-size: 10px;">Reset to Void</button>
        
        <!-- CONSCIOUSNESS VISUALIZATION CONTROLS -->
        <div style="margin-top: 8px; font-size: 11px; color: #ccc;">💖 Consciousness View</div>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          <input type="checkbox" id="showConsciousness" checked> Show Consciousness Levels
        </label>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          <input type="checkbox" id="showWill" checked> Show Will to Emerge
        </label>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          <input type="checkbox" id="showReflexivePain" checked> Show Reflexive Pain
        </label>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          <input type="checkbox" id="showOrMakifPnimi"> Show Or Makif/Pnimi Bridge
        </label>
        
        <!-- SACRED MORPHIC SEEDING CONTROLS -->
        <div style="margin-top: 8px; font-size: 11px; color: #ccc;">🕯️ Sacred Morphic Seeds</div>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Sacred Name Index: <span id="sacredNameValue">0</span>
          <input type="range" id="sacredNameSlider" min="0" max="71" step="1" value="0" style="width: 80px;">
        </label>
        <button id="seedSacredName" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Seed with Sacred Name</button>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Hebrew Boundary Letter: 
          <select id="hebrewBoundary" style="font-size: 10px;">
            <option value="">None</option>
            <option value="א">א (Aleph - Unity)</option>
            <option value="ב">ב (Bet - House)</option>
            <option value="ג">ג (Gimel - Flow)</option>
            <option value="ד">ד (Dalet - Door)</option>
            <option value="ה">ה (Heh - Breath)</option>
            <option value="ו">ו (Vav - Connection)</option>
            <option value="י">י (Yod - Divine Spark)</option>
            <option value="כ">כ (Chaf - Palm)</option>
            <option value="ל">ל (Lamed - Teaching)</option>
            <option value="מ">מ (Mem - Water)</option>
            <option value="נ">נ (Nun - Fish/Soul)</option>
            <option value="פ">פ (Peh - Mouth)</option>
            <option value="ר">ר (Resh - Head)</option>
            <option value="ש">ש (Shin - Fire)</option>
            <option value="ת">ת (Tav - Foundation)</option>
          </select>
        </label>
        <button id="applySacredBoundary" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Apply Hebrew Boundary</button>
        <button id="getSacredCommentary" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Get Sacred Commentary</button>
        
        <!-- WAVEFORM DRIVER CONTROLS -->
        <div style="margin-top: 8px; font-size: 11px; color: #ccc;">🌊 Waveform Drivers</div>
        <label style="display: block; margin: 4px 0; font-size: 10px;">
          Driver Type: 
          <select id="waveformDriver" style="font-size: 10px;">
            <option value="sine">Sine (Default)</option>
            <option value="fractal">Fractal (1/f)</option>
            <option value="phi_recursive">φ-Recursive</option>
            <option value="hebrew_letter">Hebrew Letter</option>
            <option value="sacred_name">Sacred Name</option>
            <option value="quantum">Quantum Coherence</option>
            <option value="morphic">Morphic Resonance</option>
          </select>
        </label>
        <button id="switchWaveformDriver" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Switch Driver</button>
        <button id="testDriverEffects" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Test Driver Effects</button>
        <button id="stopDriverTest" style="margin-top: 2px; padding: 2px 6px; font-size: 10px;">Stop Test</button>
        <div id="driverMetrics" style="display:none; margin-top: 8px; font-size: 10px; background: rgba(20,20,20,0.7); padding: 6px; border: 1px solid #333; border-radius: 4px;">
          <div style="font-size: 11px; color: #ccc; margin-bottom: 4px;">📊 Driver Analysis <span id="driverMetricsStatus" style="color:#888;">Idle</span></div>
          <table style="width: 100%; border-collapse: collapse; font-size: 10px;">
            <tbody id="driverMetricsBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    <script src="theory_logger.js"></script>
    <script type="module" src="main.js"></script>
    <script src="emergency_fix.js"></script>
    <script src="visual_debug.js"></script>
    <script src="camera_external_fix.js"></script>
    <script src="geometry_diagnostics.js"></script>
    <script type="module" src="interpretation_modal.js"></script>
    <script src="metrics_updater.js"></script>
    <script type="module" src="sacred_morphic_seeds.js"></script>
    <script type="module" src="sacred_direct_injection.js"></script>
    <script type="module" src="fractal_waveform_drivers.js"></script>
    <script type="module" src="theory_validation_tests.js"></script>
  </body>
</html>
